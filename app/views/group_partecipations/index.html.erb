<h1>Elenco partecipanti</h1>
<% if current_user && ((@group.portavoce.include? current_user) || is_admin?) %>
    <fieldset>
      <legend>Ricerca</legend>

      <%= form_for [@group, SearchPartecipant.new], remote: true do |f| %>
          <p><%= f.label :keywords %><br/>
            <%= f.text_field :keywords %>
          </p>

          <p>
            <%= f.label :role_id %><br/>
            <%= f.select :role_id, options_from_collection_for_select([OpenStruct.new({id: PartecipationRole::PORTAVOCE, name: @group.admin_title || t('pages.groups.default_admin_title')})] + @group.partecipation_roles, :id, :name), :prompt => 'Scegli un ruolo' %>
          </p>

          <p>
            <%= f.label :status_id %><br/>
            <%= f.select :status_id, options_from_collection_for_select(GroupPartecipationRequestStatus.all, :id, :description), :prompt => 'Scegli uno stato di iscrizione' %>
          </p>
          <%= f.button 'Filtra', class: 'btn blue' %>
      <% end %>

    </fieldset>
    <br/>

    <fieldset>
      <legend>Operazioni sugli utenti</legend>
      <%= link_to 'Invia email', '#', remote: true, class: 'btn inviteButton', onclick: 'show_email_form();return false;' %>

      <div id="email_panel" style="display: none" title="Invio mail massiva">
        <%= form_for 'message', :url => send_email_group_group_partecipations_path(@group), :remote => true, method: :post, :class=>'disableForm' do |e| %>
            <p>
              <%= e.label t('pages.users.send_message.subject_label') %> <br/>
              <%= e.text_field 'subject' %>
            </p>
            <p>
              <%= e.label t('pages.users.send_message.body_label') %> <br/>
              <%= e.text_area 'body', rows: 10 %>
            </p>

            <%= e.hidden_field 'receiver_ids' %>


            <a href="#" class="btn" onclick="$('#email_panel').dialog('destroy');return false;"><%=t('buttons.cancel')%></a>
            <%= e.submit t('buttons.send'), :class => 'btn blue disable' %>
        <% end %>

      </div>
    </fieldset>
<% end %>
<br/>

<div id="results_panel">
  <%= render :partial => 'group_partecipation_results' %>
</div>

<script type="text/javascript">
    function show_email_form() {
        $('#email_panel').dialog({'width': '400px'});
        $('#message_receiver_ids').val($('#ids_results').val());
    }
</script>