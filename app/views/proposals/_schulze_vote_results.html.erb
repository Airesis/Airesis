<% solution_ids = @proposal.solutions.pluck(:id) %>
<div>
  <dl class="tabs" data-tab>
    <dd class="active"><%= link_to t('.results'), '#results' %></dd>
    <dd><%= link_to t('.votes'), '#votes' %></dd>
  </dl>
  <div class="tabs-content">
    <div class="content active" id="results">
      <div class="card">
        <h3><%= t('pages.proposals.results.total', count: @proposal.schulze_votes.sum(:count)) %></h3>
      </div>
      <div class="card">
        <% if @proposal_votation_result.calculated && @proposal_votation_result.classifications.count == 1 %>
            <h3><%= "We calculated a final rank for your solutions" %></h3>
            <%= classification = @proposal_votation_result.classifications.first %>
            <% classification.each do |solution_id| %>
                <div>
                  <% solution = @proposal.solutions.find { |solution| solution.id == solution_id } %>
                  <%= raw t("pages.proposals.edit.new_solution_title.#{@proposal.proposal_type.name.downcase}",
                            num: solution_ids.index(solution.id)+1) %>
                  <%= solution.title %>
                </div>
            <% end %>
        <% else %>
            <h3><%= 'Here is the list of potential winners' %></h3>
            <% @proposal_votation_result.winners.each do |winner_id| %>
                <div>
                  <%= @proposal.solutions.find { |solution| solution.id == winner_id }.title %>
                </div>
            <% end %>
        <% end %>
      </div>

      <div class="card">
        <h3><%= t('.voters') %></h3>
        <table class="votes-table" data-votes-table>
          <thead>
          <th><%= t('pages.proposals.results.name_surname_column') %></th>
          <th><%= t('pages.proposals.results.date_time_column') %></th>
          <% unless @proposal.secret_vote %>
              <th><%= t('pages.proposals.results.vote_column') %></th>
          <% end %>
          </thead>
          <% @proposal.user_votes.each do |user_vote| %>
              <tr>
                <td><%= user_vote.user.fullname %></td>
                <td><%= l user_vote.created_at %></td>
                <% unless @proposal.secret_vote %>
                    <td><%= @proposal.is_schulze? ? user_vote.desc_vote_schulze : user_vote.vote_type.description %></td>
                <% end %>
              </tr>
          <% end %>
        </table>
      </div>
    </div>
    <div class="content" id="votes">
      <div class="card">
        <h3><%= t('.random_ordered_votes') %></h3>
        <table id="cast_table">
          <thead>
          <th><%= t('.number_of_voters') %></th>
          <th><%= t('.vote') %></th>
          </thead>
          <tbody>
          <% @proposal.schulze_votes.each do |vote| %>
              <tr>
                <td><%= vote.count %></td>
                <td><%= vote.description %></td>
              </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
